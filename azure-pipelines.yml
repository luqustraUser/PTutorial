trigger:
  branches:
    include:
      - main

pool:
  name: default  # Uses the default agent pool

variables:
- group: Hub_Spoke  # Only keep this if it contains non-auth Terraform vars like TF_VAR_location, etc.

stages:
- stage: Terraform
  jobs:
  - job: InitPlanApply
    steps:
    - checkout: self

    # Authenticate with Azure using service connection
    - task: AzureCLI@2
      inputs:
        azureSubscription: 'AzureConnection-PTutorial'
        scriptType: 'pscore'
        scriptLocation: 'inlineScript'
        inlineScript: |
          # Show Terraform version
          terraform version

          # Run Terraform commands
          terraform init -reconfigure
          terraform plan
          terraform apply -auto-approve
